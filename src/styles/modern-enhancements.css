/* ✨ Modern CSS Enhancements - 2025 Edition */
@layer utilities, enhancements;

@layer enhancements {
  /* 🚀 Advanced CSS Features */
  
  /* CSS View Transitions API Support */
  @view-transition {
    navigation: auto;
  }
  
  ::view-transition-old(root),
  ::view-transition-new(root) {
    animation-duration: 0.4s;
    animation-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  ::view-transition-old(root) {
    animation-name: slide-out-to-left;
  }
  
  ::view-transition-new(root) {
    animation-name: slide-in-from-right;
  }
  
  @keyframes slide-out-to-left {
    to { transform: translateX(-100%); }
  }
  
  @keyframes slide-in-from-right {
    from { transform: translateX(100%); }
  }
  
  /* 🎯 Focus Management with Modern Selectors */
  :focus-visible {
    outline: 2px solid var(--color-primary);
    outline-offset: 2px;
    border-radius: var(--radius-sm);
  }
  
  /* Enhanced :has() selector usage */
  .card:has(.card__image) {
    --card-padding: 0;
    
    .card__content {
      padding: var(--space-lg);
    }
  }
  
  .form:has(input:invalid) {
    --form-border-color: var(--color-error);
  }
  
  .navigation:has(.nav-item--active) {
    --nav-indicator-opacity: 1;
  }
  
  /* 📱 Advanced Container Queries */
  @container (min-width: 400px) and (orientation: landscape) {
    .responsive-grid {
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    }
  }
  
  @container style(--theme: dark) {
    .theme-adaptive {
      filter: invert(1) hue-rotate(180deg);
    }
  }
  
  /* 🎨 CSS Anchor Positioning (Future-proofing) */
  .tooltip {
    position: absolute;
    position-anchor: --trigger;
    top: anchor(bottom);
    left: anchor(center);
    translate: -50% 0.5rem;
  }
  
  .dropdown {
    position: absolute;
    position-anchor: --button;
    top: anchor(bottom);
    left: anchor(left);
  }
  
  /* 🌈 Advanced Color Functions */
  .color-scheme-adaptive {
    background: light-dark(
      oklch(98% 0.01 250),
      oklch(15% 0.01 250)
    );
    color: light-dark(
      oklch(20% 0.01 250),
      oklch(90% 0.01 250)
    );
  }
  
  /* Dynamic color mixing */
  .accent-adaptive {
    background: color-mix(in oklch, var(--color-primary) 80%, var(--color-surface) 20%);
  }
  
  /* 🎭 Advanced Animations */
  .scroll-driven-animation {
    animation: progress-indicator linear;
    animation-timeline: scroll(root);
    animation-range: 0% 100%;
  }
  
  @keyframes progress-indicator {
    from { transform: scaleX(0); }
    to { transform: scaleX(1); }
  }
  
  /* Entrance animations with intersection observer API integration */
  .animate-on-scroll {
    opacity: 0;
    transform: translateY(2rem);
    transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
    
    &.is-visible {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  /* 🖼️ Modern Image Enhancements */
  .progressive-image {
    /* Modern aspect ratio */
    aspect-ratio: 16 / 9;
    object-fit: cover;
    
    /* Loading state with skeleton */
    &[data-loading="true"] {
      background: 
        linear-gradient(90deg, 
          transparent 0%, 
          oklch(from var(--color-surface) calc(l + 0.05) c h) 50%, 
          transparent 100%),
        var(--color-surface-variant);
      background-size: 200% 100%;
      animation: skeleton-loading 1.5s ease-in-out infinite;
    }
  }
  
  @keyframes skeleton-loading {
    0% { background-position: -200% 0; }
    100% { background-position: 200% 0; }
  }
  
  /* 🎪 Morphing Buttons */
  .morph-button {
    transition: 
      border-radius 0.3s cubic-bezier(0.4, 0, 0.2, 1),
      transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
      background 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    
    &:hover {
      border-radius: var(--radius-full);
      transform: scale(1.05);
      background: linear-gradient(45deg, var(--color-primary), var(--color-secondary));
    }
  }
  
  /* 🌊 Liquid Backgrounds */
  .liquid-background {
    background: 
      radial-gradient(circle at 25% 25%, var(--color-primary) 0%, transparent 50%),
      radial-gradient(circle at 75% 75%, var(--color-secondary) 0%, transparent 50%),
      radial-gradient(circle at 50% 50%, var(--color-accent) 0%, transparent 70%);
    background-size: 200% 200%;
    animation: liquid-flow 10s ease-in-out infinite;
  }
  
  @keyframes liquid-flow {
    0%, 100% { background-position: 0% 50%; }
    25% { background-position: 100% 25%; }
    50% { background-position: 50% 100%; }
    75% { background-position: 25% 0%; }
  }
  
  /* 🎯 Smart Grid Layouts */
  .smart-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(min(250px, 100%), 1fr));
    gap: var(--space-lg);
    container-type: inline-size;
    
    /* Dynamic column adjustment */
    @container (min-width: 1200px) {
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    }
    
    @container (max-width: 600px) {
      grid-template-columns: 1fr;
      gap: var(--space-md);
    }
    
    /* Grid item enhancements */
    > * {
      container-type: inline-size;
      
      /* Self-adjusting based on content */
      &:has(.priority-content) {
        grid-column: span 2;
        
        @container (max-width: 800px) {
          grid-column: span 1;
        }
      }
    }
  }
  
  /* 🎨 Dynamic Typography */
  .fluid-typography {
    font-size: clamp(1rem, 2vw + 1rem, 2rem);
    line-height: calc(1.2 + 0.5 * (100vw - 320px) / (1200 - 320));
    
    /* Container query font scaling */
    @container (min-width: 600px) {
      font-size: clamp(1.2rem, 3vw + 1rem, 2.5rem);
    }
  }
  
  /* 🌟 Glassmorphism Effects */
  .glass-card {
    background: oklch(from var(--color-surface) calc(l + 0.05) c h / 0.8);
    backdrop-filter: blur(20px) saturate(1.2);
    -webkit-backdrop-filter: blur(20px) saturate(1.2);
    border: 1px solid oklch(from var(--color-surface) calc(l + 0.1) c h / 0.3);
    
    /* Enhanced glass effect on hover */
    &:hover {
      background: oklch(from var(--color-surface) calc(l + 0.08) c h / 0.9);
      backdrop-filter: blur(25px) saturate(1.4);
      -webkit-backdrop-filter: blur(25px) saturate(1.4);
    }
  }
  
  /* 🎪 Advanced Hover Effects */
  .tilt-effect {
    transform-style: preserve-3d;
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    
    &:hover {
      transform: perspective(1000px) rotateX(10deg) rotateY(10deg) translateZ(20px);
    }
    
    &::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, 
        oklch(from var(--color-primary) l c h / 0.1) 0%, 
        transparent 50%);
      opacity: 0;
      transition: opacity 0.3s ease;
      border-radius: inherit;
    }
    
    &:hover::before {
      opacity: 1;
    }
  }
  
  /* 🌈 Color Harmony Generator */
  .color-harmony {
    --base-hue: 250;
    --base-saturation: 0.15;
    --base-lightness: 70%;
    
    /* Triadic color scheme */
    --color-triadic-1: oklch(var(--base-lightness) var(--base-saturation) var(--base-hue));
    --color-triadic-2: oklch(var(--base-lightness) var(--base-saturation) calc(var(--base-hue) + 120));
    --color-triadic-3: oklch(var(--base-lightness) var(--base-saturation) calc(var(--base-hue) + 240));
    
    /* Analogous color scheme */
    --color-analogous-1: oklch(var(--base-lightness) var(--base-saturation) calc(var(--base-hue) - 30));
    --color-analogous-2: oklch(var(--base-lightness) var(--base-saturation) var(--base-hue));
    --color-analogous-3: oklch(var(--base-lightness) var(--base-saturation) calc(var(--base-hue) + 30));
  }
  
  /* 🎯 Smart Focus Indicators */
  .smart-focus {
    /* Enhanced focus ring */
    &:focus-visible {
      outline: 2px solid var(--color-primary);
      outline-offset: 2px;
      box-shadow: 
        0 0 0 2px var(--color-surface),
        0 0 0 4px var(--color-primary),
        0 0 20px oklch(from var(--color-primary) l c h / 0.3);
    }
    
    /* Focus within containers */
    &:focus-within {
      box-shadow: inset 0 0 0 2px oklch(from var(--color-primary) l c h / 0.2);
    }
  }
}

@layer utilities {
  /* 🛠️ Modern Utility Classes */
  
  /* Scroll snap utilities */
  .scroll-snap-x {
    scroll-snap-type: x mandatory;
    overflow-x: auto;
    
    > * {
      scroll-snap-align: start;
    }
  }
  
  .scroll-snap-y {
    scroll-snap-type: y mandatory;
    overflow-y: auto;
    
    > * {
      scroll-snap-align: start;
    }
  }
  
  /* Masonry layout */
  .masonry {
    columns: var(--masonry-columns, auto);
    column-width: var(--masonry-width, 250px);
    column-gap: var(--masonry-gap, var(--space-lg));
    column-fill: balance;
    
    > * {
      break-inside: avoid;
      margin-bottom: var(--masonry-gap, var(--space-lg));
    }
  }
  
  /* Subgrid support */
  .subgrid {
    display: grid;
    grid-template-columns: subgrid;
    grid-template-rows: subgrid;
  }
  
  /* Modern centering */
  .center-absolute {
    position: absolute;
    inset: 0;
    display: grid;
    place-items: center;
  }
  
  .center-flex {
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  /* Aspect ratio utilities */
  .aspect-square { aspect-ratio: 1; }
  .aspect-video { aspect-ratio: 16 / 9; }
  .aspect-photo { aspect-ratio: 4 / 3; }
  .aspect-ultrawide { aspect-ratio: 21 / 9; }
  
  /* Text balancing */
  .text-balance {
    text-wrap: balance;
  }
  
  .text-pretty {
    text-wrap: pretty;
  }
  
  /* Logical properties */
  .padding-inline { padding-inline: var(--space-md); }
  .padding-block { padding-block: var(--space-md); }
  .margin-inline-auto { margin-inline: auto; }
  .margin-block-auto { margin-block: auto; }
  
  /* Color scheme utilities */
  .light-only {
    @media (prefers-color-scheme: dark) {
      display: none;
    }
  }
  
  .dark-only {
    @media (prefers-color-scheme: light) {
      display: none;
    }
  }
}

/* 🎭 Accessibility Enhancements */
@media (prefers-reduced-motion: reduce) {
  .scroll-driven-animation,
  .liquid-background,
  .skeleton-loading {
    animation: none !important;
  }
  
  .animate-on-scroll {
    opacity: 1 !important;
    transform: none !important;
  }
}

@media (prefers-contrast: high) {
  .glass-card {
    background: var(--color-surface);
    backdrop-filter: none;
    border: 2px solid var(--color-outline);
  }
}

/* 🖨️ Print Optimizations */
@media print {
  .liquid-background,
  .glass-card {
    background: white !important;
    backdrop-filter: none !important;
  }
  
  .tilt-effect:hover {
    transform: none !important;
  }
}