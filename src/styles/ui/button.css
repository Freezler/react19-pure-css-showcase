/* ‚ú® Reusable Button Component System */
@layer components {
  
  /* üèóÔ∏è Base Button Structure */
  .btn {
    --btn-bg: var(--color-primary);
    --btn-color: var(--color-on-primary);
    --btn-border: var(--color-primary);
    --btn-shadow: var(--shadow-sm);
    --btn-shadow-hover: var(--shadow-md);
    --btn-radius: var(--radius-lg);
    --btn-padding: var(--space-sm) var(--space-md);
    --btn-gap: var(--space-xs);
    --btn-font-size: var(--text-sm);
    --btn-font-weight: 500;
    --btn-line-height: 1;
    --btn-transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease, border-color 0.2s ease, color 0.2s ease;
    
    /* Base styles */
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--btn-gap);
    padding: var(--btn-padding);
    font-family: inherit;
    font-size: var(--btn-font-size);
    font-weight: var(--btn-font-weight);
    line-height: var(--btn-line-height);
    color: var(--btn-color);
    background: var(--btn-bg);
    border: 1px solid var(--btn-border);
    border-radius: var(--btn-radius);
    box-shadow: var(--btn-shadow);
    cursor: pointer;
    transition: var(--btn-transition);
    text-decoration: none;
    white-space: nowrap;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
    
    /* Prevent flickering and layout shifts */
    will-change: transform, box-shadow;
    backface-visibility: hidden;
    transform: translateZ(0);
    
    /* Contain layout shifts */
    contain: layout style;
    
    /* Focus and interaction prep */
    &:focus-visible {
      outline: 2px solid var(--color-primary);
      outline-offset: 2px;
    }
    
    &:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: var(--btn-shadow-hover);
    }
    
    &:active:not(:disabled) {
      transform: translateY(0);
    }
  }

  /* üé® Button Variants */
  .btn--primary {
    --btn-bg: linear-gradient(135deg, var(--color-primary), oklch(from var(--color-primary) calc(l * 0.9) c h));
    --btn-color: var(--color-on-primary);
    --btn-border: var(--color-primary);
    position: relative;
    
    &:hover:not(:disabled) {
      --btn-bg: linear-gradient(135deg, 
        oklch(from var(--color-primary) calc(l * 1.1) c h), 
        oklch(from var(--color-primary) calc(l * 0.95) c h));
      --btn-border: oklch(from var(--color-primary) calc(l * 1.1) c h);
    }
  }

  .btn--secondary {
    --btn-bg: var(--color-secondary);
    --btn-color: var(--color-on-secondary);
    --btn-border: var(--color-secondary);
    
    &:hover:not(:disabled) {
      --btn-bg: var(--color-secondary-variant);
      --btn-border: var(--color-secondary-variant);
    }
  }

  .btn--outline {
    --btn-bg: transparent;
    --btn-color: var(--color-primary);
    --btn-border: var(--color-primary);
    
    &:hover:not(:disabled) {
      --btn-bg: oklch(from var(--color-primary) l c h / 0.1);
      --btn-color: oklch(from var(--color-primary) calc(l * 0.9) c h);
      --btn-border: oklch(from var(--color-primary) calc(l * 0.9) c h);
    }
  }

  .btn--ghost {
    --btn-bg: transparent;
    --btn-color: var(--color-on-surface);
    --btn-border: transparent;
    --btn-shadow: none;
    
    &:hover:not(:disabled) {
      --btn-bg: oklch(from var(--color-surface) calc(l * 0.95) c h);
      --btn-color: var(--color-primary);
      --btn-shadow: var(--shadow-sm);
    }
  }

  .btn--danger {
    --btn-bg: var(--color-error);
    --btn-color: var(--color-on-error);
    --btn-border: var(--color-error);
    
    &:hover:not(:disabled) {
      --btn-bg: var(--color-error-variant);
      --btn-border: var(--color-error-variant);
    }
  }

  /* üìè Button Sizes */
  .btn--sm {
    --btn-padding: var(--space-xs) var(--space-sm);
    --btn-font-size: var(--text-xs);
    --btn-radius: var(--radius-md);
    --btn-gap: var(--space-2xs);
  }

  .btn--md {
    /* Default size already applied - uses --radius-lg */
  }

  .btn--lg {
    --btn-padding: var(--space-md) var(--space-lg);
    --btn-font-size: var(--text-base);
    --btn-radius: var(--radius-xl);
    --btn-gap: var(--space-sm);
  }

  .btn--xl {
    --btn-padding: var(--space-lg) var(--space-xl);
    --btn-font-size: var(--text-lg);
    --btn-radius: var(--radius-2xl);
    --btn-gap: var(--space-sm);
  }

  /* üéõÔ∏è Button States */
  .btn--full-width {
    width: 100%;
  }

  .btn--icon-only {
    --btn-padding: var(--space-sm);
    aspect-ratio: 1;
    
    .btn__text {
      display: none;
    }
  }

  .btn--icon-only.btn--sm {
    --btn-padding: var(--space-xs);
  }

  .btn--icon-only.btn--lg {
    --btn-padding: var(--space-md);
  }

  .btn--icon-only.btn--xl {
    --btn-padding: var(--space-lg);
  }

  .btn:disabled {
    --btn-bg: var(--color-outline-variant);
    --btn-color: var(--color-on-surface-variant);
    --btn-border: var(--color-outline-variant);
    --btn-shadow: none;
    cursor: not-allowed;
    opacity: 0.6;
    
    &:hover {
      transform: none;
      box-shadow: var(--btn-shadow);
    }
  }

  /* ‚è≥ Loading States */
  .btn--loading {
    cursor: not-allowed;
    
    .btn__content--hidden {
      opacity: 0;
    }
  }

  .btn__spinner {
    position: absolute;
    width: 16px;
    height: 16px;
    border: 2px solid transparent;
    border-top-color: currentColor;
    border-radius: 50%;
    animation: btn-spin 1s linear infinite;
  }

  @keyframes btn-spin {
    to { transform: rotate(360deg); }
  }

  /* üèóÔ∏è Button Content Structure */
  .btn__content {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--btn-gap);
    transition: opacity var(--transition-fast) ease;
    position: relative;
    z-index: 1;
  }

  .btn__text {
    flex: 1;
    text-align: center;
  }

  .btn__icon {
    font-size: 1em;
    flex-shrink: 0;
    transition: transform var(--transition-fast) ease;
  }

  .btn__icon--left {
    margin-right: calc(var(--btn-gap) * -0.5);
  }

  .btn__icon--right {
    margin-left: calc(var(--btn-gap) * -0.5);
  }

  /* ‚ú® Ripple Effect */
  .btn__ripple {
    position: absolute;
    inset: 0;
    overflow: hidden;
    border-radius: inherit;
    pointer-events: none;
    
    &::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: oklch(from var(--btn-color) l c h / 0.2);
      transform: translate(-50%, -50%);
      transition: width 0.4s ease, height 0.4s ease;
    }
  }

  .btn:active:not(:disabled) .btn__ripple::after {
    width: 300px;
    height: 300px;
  }

  /* üèóÔ∏è Button Groups with Container Queries */
  .btn-group {
    display: flex;
    gap: var(--space-md);
    container-type: inline-size;
    container-name: btn-group;
  }

  .btn-group--horizontal {
    flex-direction: row;
    flex-wrap: wrap;
    align-items: center;
  }

  .btn-group--vertical {
    flex-direction: column;
    align-items: stretch;
  }

  .btn-group--spacing-sm {
    gap: var(--space-sm);
  }

  .btn-group--spacing-md {
    gap: var(--space-md);
  }

  .btn-group--spacing-lg {
    gap: var(--space-lg);
  }

  /* üì± Container Query Responsive Button Groups */
  @container btn-group (max-width: 400px) {
    .btn-group--horizontal {
      flex-direction: column;
      align-items: stretch;
      gap: var(--space-sm);
    }
    
    .btn-group--horizontal .btn {
      width: 100%;
    }
    
    .btn-group--spacing-lg {
      gap: var(--space-md);
    }
  }

  @container btn-group (min-width: 600px) {
    .btn-group--spacing-sm {
      gap: var(--space-md);
    }
    
    .btn-group--spacing-md {
      gap: var(--space-lg);
    }
  }

  /* Connected button group (no gaps) */
  .btn-group--connected {
    gap: 0;
    
    .btn {
      border-radius: 0;
      
      &:first-child {
        border-top-left-radius: var(--btn-radius);
        border-bottom-left-radius: var(--btn-radius);
      }
      
      &:last-child {
        border-top-right-radius: var(--btn-radius);
        border-bottom-right-radius: var(--btn-radius);
      }
      
      &:not(:first-child) {
        border-left-width: 0;
      }
      
      &:hover {
        z-index: 1;
        border-left-width: 1px;
      }
    }
  }

  .btn-group--connected.btn-group--vertical {
    .btn {
      &:first-child {
        border-radius: var(--btn-radius) var(--btn-radius) 0 0;
      }
      
      &:last-child {
        border-radius: 0 0 var(--btn-radius) var(--btn-radius);
      }
      
      &:not(:first-child) {
        border-left-width: 1px;
        border-top-width: 0;
      }
      
      &:hover {
        border-left-width: 1px;
        border-top-width: 1px;
      }
    }
  }

  /* üì± Container queries handle responsive behavior above */

  /* üåô Theme Variations */
  [data-theme="dark"] .btn--ghost {
    &:hover:not(:disabled) {
      --btn-bg: oklch(25% 0.02 250);
    }
  }

  /* ‚ôø Accessibility Enhancements */
  .btn:focus-visible {
    z-index: 2;
  }

  /* High contrast mode */
  @media (prefers-contrast: high) {
    .btn {
      border-width: 2px;
    }
    
    .btn--ghost {
      --btn-border: var(--color-outline);
    }
  }

  /* üé≠ Reduced Motion Support */
  @media (prefers-reduced-motion: reduce) {
    .btn,
    .btn__icon,
    .btn__content,
    .btn__spinner {
      transition: none !important;
      animation: none !important;
    }
    
    .btn:hover:not(:disabled) {
      transform: none;
    }
    
    .btn__ripple::after {
      transition: none !important;
    }
  }

  /* üñ®Ô∏è Print Styles */
  @media print {
    .btn {
      color: #000 !important;
      background: white !important;
      border: 1px solid #000 !important;
      box-shadow: none !important;
    }
    
    .btn__spinner {
      display: none;
    }
  }
}